# env-tool

CLI for encrypted environment variable management with type generation and multi-target sync.

## Architecture

```
src/
├── cli.ts              # Commander.js entry, registers all commands
├── config.ts           # Config schema (valibot), loads env.config.ts
├── commands/
│   ├── init.ts         # Project init: .env.keys, .env.*, env.config.ts, .gitignore
│   ├── sync.ts         # Core: decrypt → typegen → sync targets (convex/wrangler)
│   ├── ls.ts           # List vars (table/json/export format)
│   ├── get.ts          # Get single var
│   ├── set.ts          # Set var (calls dotenvx set CLI)
│   ├── rm.ts           # Remove var (direct file edit)
│   └── diff.ts         # Compare dev/prod or local vs sync targets
└── utils/
    ├── dotenv.ts       # Load/parse/serialize env files, uses @dotenvx/dotenvx
    ├── typegen.ts      # Generate TypeScript types (valibot/zod/none)
    ├── sync-convex.ts  # Sync to Convex via `convex env` CLI
    ├── sync-wrangler.ts # Sync to Cloudflare Workers via `wrangler secret` CLI
    └── color.ts        # Terminal colors
```

## Key Concepts

- **Encryption**: Uses `@dotenvx/dotenvx` for encryption/decryption
- **Private keys**: Stored in `~/.env.keys` (symlinked to project), or `DOTENV_PRIVATE_KEY_*` env vars
- **`.env.local`**: Decrypted version of `.env.development` for local dev, auto-generated by `sync`
- **Public vs Private**: Variables with `VITE_`/`PUBLIC_` prefix are public, others are private

## Data Flow

```
.env.development (encrypted)
       ↓ loadEnvFile() + dotenvx.parse()
   EnvRecord (decrypted key-value pairs)
       ↓
   ├─→ .env.local (for local dev)
   ├─→ typegen → src/env.ts (TypeScript types)
   ├─→ syncToConvex → convex env set
   └─→ syncToWrangler → wrangler secret bulk
```

## Dev Commands

```bash
bun run src/cli.ts <command>  # Run locally
bun test                       # Run tests
bun run build                  # Build
```

## Code Conventions

- No barrel files (index.ts)
- `type` over `interface`
- kebab-case file names
- Direct imports, no re-exports
- Schema validator: valibot
